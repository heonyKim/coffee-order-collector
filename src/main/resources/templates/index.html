<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
  <script th:src="@{/js/common.js}"></script>
</head>
  <title th:text="${title}"></title>
</head>
<body>
  <div class="bg-white dark:bg-gray-800 flex min-h-full flex-col justify-center px-6 py-12 lg:px-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-sm">

      <div class="grid grid-cols-6 gap-4">


        <div></div>
        <div class="col-span-4  text-center">
          <img class="mx-auto" th:src="@{/images/logo.svg}" alt="Your Company">
        </div>
        <div></div>

        <div></div>
        <div class="col-span-4 text-center flex">
          <button class="rounded-xl bg-stone-100 px-4 py-2 text-sm font-semibold focus:outline-none flex-auto">
            <span th:text="${today}">1970-01-01</span>
            <span th:text="${title}"></span>
          </button>
        </div>
        <div></div>

        <div class="col-span-6"></div>

        <div class="col-span-3 text-center flex">
          <button id="menu-area-btn" class="rounded-md cursor-pointer bg-blue-500 px-4 py-2 text-sm text-white font-semibold flex-auto">메뉴</button>
        </div>
        <div class="col-span-3 text-center flex">
          <button id="order-list-btn" class="rounded-md cursor-pointer px-4 py-2 text-sm font-semibold text-blue-500 border-2 border-blue-500 flex-auto">주문리스트</button>
        </div>


        <!---------------------------------------메뉴--------------------------------------------->
        <div class="col-span-6 grid grid-cols-6 gap-4" id="menu-area">

          <div class="col-span-2 py-2"><span class="align-middle">이름</span></div>
          <div class="col-span-3 flex">

            <!-- 회원 선택 UI와 새로고침 버튼을 감싸는 컨테이너 -->
            <div class="member-select-wrapper flex items-center">

              <!-- 새로고침 버튼 -->
              <button id="member-refresh-btn" class="p-2.5" title="리스트 새로고침">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 6V4l-4 4 4 4V8c3.31 0 6 2.69 6 6a6 6 0 01-6 6 6.002 6.002 0 01-5.657-4H4.07a8.003 8.003 0 007.93 6 8 8 0 000-16z"/>
                </svg>
              </button>

              <!-- 회원 선택 영역 -->
              <div class="member-select-container relative">
                <!-- 입력 필드와 화살표 아이콘 영역 -->
                <div class="relative">
                  <input
                          type="text"
                          id="member-search-input"
                          placeholder="회원 선택"
                          class="w-full border border-gray-300 rounded-md px-3 py-2 pr-8"
                          autocomplete="off">
                  <!-- 아래방향 화살표 아이콘 -->
                  <svg
                          id="member-toggle-arrow"
                          class="absolute top-1/2 right-3 transform -translate-y-1/2 w-4 h-4 text-gray-500 cursor-pointer transition-transform duration-200"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </div>

                <!-- 회원 리스트 옵션 (초기에는 비어있음, JS에서 API 호출 후 구성) -->
                <ul
                        id="member-options-list"
                        class="absolute left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto z-10 hidden">
                  <!-- 회원 옵션은 JavaScript에서 생성 -->
                </ul>

                <!-- 선택한 회원의 id를 저장 (폼 전송 시 사용) -->
                <input type="hidden" name="selectedMemberId" id="member-selected-id">
              </div>
            </div>



          </div>
          <div class="col-span-1 text-center flex">
            <button id="member-modification-btn" class="rounded-md cursor-pointer px-4 py-2 text-sm font-semibold text-blue-500 border-1 border-stone-300 flex-auto">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M4 18L20 18" stroke="#57534d" stroke-width="2" stroke-linecap="round"></path> <path d="M4 12L20 12" stroke="#57534d" stroke-width="2" stroke-linecap="round"></path> <path d="M4 6L20 6" stroke="#57534d" stroke-width="2" stroke-linecap="round"></path> </g></svg>
            </button>
          </div>

          <div class="col-span-6"></div>

          <div class="col-span-4 text-center flex">
            <button id="menu-list" class="rounded-md cursor-pointer bg-blue-800 px-4 py-2 text-sm text-white font-semibold flex-auto">메뉴리스트</button>
          </div>

          <!--  -->
          <!-- [메뉴목록] 모달 -->
          <div id="menuModal" class="fixed inset-0 hidden z-40 flex items-center justify-center bg-black bg-opacity-50">
            <!-- inner container에 최대 높이와 수직 스크롤을 추가 -->
            <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-4xl max-h-[90vh] overflow-y-auto">
              <div class="p-4">
                <!-- 모달 헤더: 제목 및 닫기 버튼 -->
                <div class="flex justify-between items-center border-b border-gray-300 pb-2">
                  <h2 class="text-xl font-semibold">메뉴 선택</h2>
                  <button onclick="closeMenuModal()" class="p-3 border-1 rounded-xl border-gray-500 text-gray-500">&times;</button>
                </div>
                <!-- 카테고리 버튼 영역 -->
                <div id="category-buttons" class="flex flex-wrap gap-2 mt-4">
                  <!-- 카테고리 버튼들이 JS로 동적 생성됩니다. -->
                </div>
                <!-- 메뉴 Grid 영역 (반응형: 최소 2컬럼 ~ 최대 6컬럼) -->
                <div id="menu-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 mt-6">
                  <!-- 각 메뉴 항목이 JS로 동적 생성됩니다. -->
                </div>
              </div>
            </div>
          </div>

          <!-- [상세 선택] 모달 (메뉴 항목 클릭 시) -->
          <div id="detailModal" class="fixed inset-0 hidden z-50 flex items-center justify-center bg-black bg-opacity-50">
            <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-2xl">
              <div class="p-4">
                <!-- 상세 모달 헤더 -->
                <div class="flex justify-between items-center border-b pb-2">
                  <h2 class="text-xl font-semibold">옵션 선택</h2>
                  <button onclick="closeDetailModal()" class="p-3 border-1 rounded-xl border-gray-500 text-gray-500">&times;</button>
                </div>
                <!-- 메뉴 이미지 (확대) -->
                <img id="detailImage" src="" alt="메뉴 이미지" class="w-full h-auto mt-4 rounded">

                <!-- 온도 선택 영역 (temperatures가 있을 경우) -->
                <div id="temperature-options" class="mt-6 hidden">
                  <span class="block font-semibold mb-2">온도 선택</span>
                  <div class="flex space-x-4">
                    <!-- 온도 옵션 라디오 버튼들이 JS로 동적 생성됩니다. -->
                  </div>
                </div>

                <!-- 사이즈 선택 영역 (menu_sizes가 있을 경우) -->
                <div id="size-options" class="mt-6 hidden">
                  <span class="block font-semibold mb-2">사이즈 선택</span>
                  <div class="flex space-x-4">
                    <!-- 사이즈 옵션 라디오 버튼들이 JS로 동적 생성됩니다. -->
                  </div>
                </div>

                <!-- 선택완료 버튼 -->
                <div class="mt-6 flex justify-end">
                  <button id="confirmSelection" class="px-6 py-2 bg-blue-500 text-white rounded shadow">
                    선택완료
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!--  -->



          <div class="col-span-2 text-center flex">
            <button id="order-pass-btn" class="rounded-md cursor-pointer px-4 py-2 text-sm font-semibold text-pink-500 border-2 border-pink-500 flex-auto">PASS</button>
          </div>

          <div class="col-span-2 py-2"><span class="align-middle">메뉴명</span></div>

          <div class="col-span-4">
            <div class="flex items-center rounded-md bg-white pl-3 outline-1 outline-gray-300 has-[input:focus-within]:outline-2 has-[input:focus-within]:outline-indigo-900">
              <div class="shrink-0 text-base text-gray-500 select-none sm:text-sm/6"></div>
              <input type="text" id="final-menu-name" class="block min-w-0 grow py-1.5 pr-3 pl-1 text-base text-gray-900 placeholder:text-gray-400 focus:outline-none sm:text-sm/6" placeholder="메뉴명 직접 입력">
            </div>

          </div>

          <div class="col-span-6">
            <hr class="h-px my-2 bg-gray-200 border-0 dark:bg-gray-700">
          </div>
          <div class="col-span-6 flex">
            <button id="order-menu-btn" class="py-6 rounded-md cursor-pointer bg-blue-800 px-4 py-2 text-sm text-white font-semibold flex-auto">주문하기</button>
          </div>

        </div>

        <!---------------------------------------주문 리스트--------------------------------------------->
        <div class="col-span-6 grid grid-cols-6 gap-4 hidden" id="order-list-area">
          <div id="order-list-refresh-area" class="col-start-5 col-span-2 cursor-pointer flex justify-end">
            <span>새로고침</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 6V4l-4 4 4 4V8c3.31 0 6 2.69 6 6a6 6 0 01-6 6 6.002 6.002 0 01-5.657-4H4.07a8.003 8.003 0 007.93 6 8 8 0 000-16z"/>
            </svg>
          </div>

          <div class="col-span-6 flex">
            <button class="rounded-xl bg-stone-100 px-4 py-2 text-sm font-semibold focus:outline-none flex-auto">주문 요약</button>
          </div>
          <div class="col-span-6 flex">
            <span id="order-total-count"></span>
          </div>
          <div class="col-span-6">
            <hr class="h-px my-2 bg-gray-300 border-0 dark:bg-gray-700">
          </div>
          <div id="order-summary" class="col-span-6 grid grid-cols-6 gap-0"></div>


          <div class="col-span-6 py-2"></div>

          <div class="col-span-6 flex">
            <button class="rounded-xl bg-stone-100 px-4 py-2 text-sm font-semibold focus:outline-none flex-auto">주문 안한 사람</button>
          </div>
          <div id="order-not-yet-area" class="col-span-6 grid grid-cols-6 gap-0"></div>

        </div>


        <!---------------------------------------회원 리스트--------------------------------------------->
        <div class="col-span-6 grid grid-cols-6 gap-0 hidden" id="member-list-area">
          <div class="col-span-6 grid grid-cols-6 gap-0 border-b-1 border-gray-200">
            <input type="hidden" value="1">
            <div class="col-span-4 align-middle my-1">김명근</div>
            <div class="col-span-2 flex justify-end">
              <button class="rounded-xl bg-pink-300 px-4 py-2 text-sm font-semibold">삭제</button>
            </div>
          </div>
          <div class="col-span-6 grid grid-cols-6 gap-0 border-b-1 border-gray-200">
            <input type="hidden" value="2"><div class="col-span-4 align-middle my-1">김성헌</div><div class="col-span-2 flex justify-end"><button class="rounded-xl bg-pink-300 px-4 py-2 text-sm font-semibold">삭제</button></div>
          </div>
        </div>


      </div>
    </div>
  </div>
  <div id="loading-area" class="fixed inset-0 flex items-center justify-center bg-black opacity-50 dark:bg-black dark:opacity-50 z-9999 hidden">
    <!-- 회전하는 스피너: modern UI 스타일 -->
    <div class="w-16 h-16 border-4 border-t-4 border-gray-200 border-t-blue-500 rounded-full animate-spin"></div>
  </div>
</body>

<!-- 스크립트 -->
<script th:src="@{/js/common.js}"></script>
<script th:inline="javascript">

  const today = [[ ${today} ]];

  const menuAreaBtn = document.getElementById("menu-area-btn");
  const orderListBtn = document.getElementById("order-list-btn");
  const orderPassBtn = document.getElementById("order-pass-btn");
  const orderMenuBtn = document.getElementById("order-menu-btn");
  const memberModificationBtn = document.getElementById("member-modification-btn");

  const menuArea = document.getElementById("menu-area");
  const orderListArea = document.getElementById("order-list-area");
  const memberListArea = document.getElementById("member-list-area");
  const loadingArea = document.getElementById("loading-area");

  document.addEventListener("DOMContentLoaded", function () {


    // 메뉴 영역 버튼 클릭 시 동작
    menuAreaBtn.addEventListener("click", function () {
      // 버튼 클래스 변경
      menuAreaBtn.className = "rounded-md cursor-pointer px-4 py-2 bg-blue-500 text-sm text-white font-semibold flex-auto";
      orderListBtn.className = "rounded-md cursor-pointer px-4 py-2 text-sm font-semibold text-blue-500 border-2 border-blue-500 flex-auto";

      // 콘텐츠 영역 전환
      menuArea.classList.remove("hidden");
      orderListArea.classList.add("hidden");
      memberListArea.classList.add("hidden");

    });

    // 주문 목록 버튼 클릭 시 동작
    orderListBtn.addEventListener("click", function () {
      // 버튼 클래스 변경
      menuAreaBtn.className = "rounded-md cursor-pointer px-4 py-2 text-sm font-semibold text-blue-500 border-2 border-blue-500 flex-auto";
      orderListBtn.className = "rounded-md cursor-pointer px-4 py-2 bg-blue-500 text-sm text-white font-semibold flex-auto";

      // 콘텐츠 영역 전환
      menuArea.classList.add("hidden");
      orderListArea.classList.remove("hidden");
      memberListArea.classList.add("hidden");
    });


    orderPassBtn.addEventListener("click", function () {
      document.getElementById('final-menu-name').value = "PASS";
    });



  });

  orderMenuBtn.addEventListener("click", async function () {
    const memberSearchInput = document.getElementById("member-search-input");
    const memberSelectedId = document.getElementById("member-selected-id");
    if(memberSearchInput.value==='' || memberSearchInput.value===null || memberSearchInput.value===undefined ||
            memberSelectedId.value==='' || memberSelectedId.value===null || memberSelectedId.value===undefined
    ){
      alert("이름이 올바르게 선택되지 않았습니다.");
      return;
    }
    const corpBrand = getCorpBrand();
    // member_id: id가 member-selected-id인 input hidden의 value
    const memberId = document.getElementById('member-selected-id').value;
    // menu_name: id가 final-menu-name인 input text의 value
    const menuName = document.getElementById('final-menu-name').value;

    // 요청 바디 구성 (member_id를 정수형으로 변환)
    const requestBody = {
      member_id: parseInt(memberId, 10),
      brand: corpBrand,
      menu_name: menuName
    };

    loadingArea.classList.remove("hidden");
    try {
      // fetch를 이용한 POST 요청 (api 통신)
      const response = await fetch('/api/v1/order-histories', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestBody)
      });

      // 통신 성공 여부 확인
      if (!response.ok) {
        response.text().then(value => {
          fetch(`api/v1/errors/${value}`)
                  .then(response => response.json())
                  .then(data => {
                    alert(data.message);
                  })
                  .catch(error => {})
        })
        loadingArea.classList.add("hidden");
        return;
      }

      // 통신 성공 후, id가 order-list-refresh-area인 div와 order-list-btn인 버튼을 순차적으로 클릭
      document.getElementById('order-list-refresh-area').click();
      document.getElementById('order-list-btn').click();
      loadingArea.classList.add("hidden");
    } catch (error) {
      console.error('주문 API 에러:', error);
      loadingArea.classList.add("hidden");
    }

  });





  /*------------*/

</script>
<script th:src="@{/js/member.js}"></script>
<script th:src="@{/js/menu.js}"></script>
<script th:src="@{/js/order.js}"></script>


</html>